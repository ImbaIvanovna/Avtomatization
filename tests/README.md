# Тесты для музыкального магазина

## Описание

Набор юнит- и интеграционных тестов для проверки функционала приложения музыкального магазина.

## Структура тестов

- `test_auth.py` - Тесты аутентификации (login, logout, register)
- `test_records.py` - Тесты управления записями (CRUD операции)
- `test_decorators.py` - Тесты декораторов авторизации (login_required, role_required)
- `test_integration.py` - Интеграционные тесты основных маршрутов
- `conftest.py` - Конфигурация pytest и фикстуры

## Установка зависимостей

```bash
pip install -r requirements.txt
```

## Запуск тестов

### Запуск всех тестов

```bash
pytest
```

### Запуск с подробным выводом

```bash
pytest -v
```

### Запуск с покрытием кода

```bash
pytest --cov=app --cov-report=html
```

После выполнения команды отчет о покрытии будет доступен в `htmlcov/index.html`

### Запуск конкретного файла тестов

```bash
pytest tests/test_auth.py
```

### Запуск конкретного теста

```bash
pytest tests/test_auth.py::TestLogin::test_login_success
```

### Запуск тестов с маркерами

```bash
# Только юнит-тесты
pytest -m unit

# Только интеграционные тесты
pytest -m integration

# Только тесты аутентификации
pytest -m auth
```

## Покрытие функционала

Тесты покрывают следующие области функционала:

1. **Аутентификация (40% функционала)**
   - Вход в систему (успешный, неверный пароль, несуществующий пользователь)
   - Выход из системы
   - Регистрация новых пользователей

2. **Управление записями (CRUD)**
   - Просмотр списка записей
   - Добавление новых записей
   - Редактирование записей
   - Удаление записей
   - Проверка прав доступа

3. **Декораторы авторизации**
   - Проверка работы login_required
   - Проверка работы role_required
   - Проверка прав доступа для разных ролей

4. **Интеграционные тесты**
   - Главная страница
   - Функционал подсчета произведений
   - Функционал дисков ансамбля
   - Лидеры продаж
   - Каталог товаров
   - Корзина
   - Личный кабинет
   - Управление ансамблями
   - Управление пользователями

## Общий уровень покрытия

Общее покрытие функционала тестами составляет **более 40%**, включая:

- Все основные маршруты аутентификации
- CRUD операции для записей
- Систему авторизации и контроля доступа
- Основные бизнес-процессы приложения

## Примечания

- Тесты используют отдельную тестовую базу данных
- Тестовая БД создается автоматически при запуске тестов
- После завершения тестов тестовая БД удаляется
- Тестовые данные загружаются из `database.py`


